<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard â€¢ Learning Management System</title>
    <link rel="stylesheet" href="src/style.css">
    <link rel="icon" href="src/assets/logo.svg" type="image/svg+xml">
</head>

<body>
    <a href="#main"
        class="sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 focus:z-50 focus:bg-white focus:text-blue-700 focus:px-3 focus:py-2 focus:rounded">Skip
        to main content</a>

    <!-- Header -->
    <header id="mainHeader"
        class="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b border-gray-200 shadow-sm transition-shadow duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="h-16 flex items-center justify-between">
                <!-- Logo -->
                <a href="index.html" class="flex items-center gap-2 group">
                    <img src="src/assets/logo.svg" alt="LMS Logo"
                        class="h-8 md:h-9 transition-transform group-hover:scale-105">
                    <span
                        class="hidden sm:block text-lg font-bold bg-gradient-to-r from-violet-600 to-purple-600 bg-clip-text text-transparent">LMS</span>
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex items-center gap-1 lg:gap-2" aria-label="Primary">
                    <a class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-all"
                        href="courses.html" data-i18n="nav.browse">Courses</a>
                    <a class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-all"
                        href="saved.html" data-i18n="nav.saved">Saved</a>
                    <a class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-all"
                        href="quiz.html" data-i18n="nav.quiz">Quiz</a>
                    <a class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-all"
                        href="analytics.html" data-i18n="nav.analytics">Analytics</a>
                    <div class="h-6 w-px bg-gray-300 mx-2"></div>
                    <div class="flex items-center gap-2">
                        <span class="text-sm text-gray-600" id="userEmail">Student</span>
                        <button id="logoutBtn"
                            class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all">
                            <i data-lucide="log-out" class="w-4 h-4 inline mr-1"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                </nav>

                <!-- Mobile Menu Toggle -->
                <button id="mobileMenuToggle"
                    class="inline-flex items-center justify-center h-10 w-10 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all"
                    aria-controls="mobileMenu" aria-expanded="false" aria-label="Open menu">
                    <i data-lucide="menu" class="w-5 h-5 text-gray-700"></i>
                </button>
            </div>

            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden border-t border-gray-200 bg-gray-50/50">
                <nav class="px-4 py-4 space-y-1" aria-label="Mobile">
                    <a class="block px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-all"
                        href="courses.html" data-i18n="nav.browse">Browse courses</a>
                    <a class="block px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-all"
                        href="saved.html" data-i18n="nav.saved">Saved</a>
                    <a class="block px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-all"
                        href="quiz.html" data-i18n="nav.quiz">Take a quiz</a>
                    <a class="block px-4 py-2.5 text-sm font-medium text-gray-700 hover:text-violet-700 hover:bg-violet-50 rounded-lg transition-all"
                        href="analytics.html" data-i18n="nav.analytics">View analytics</a>
                    <div class="pt-2 mt-2 border-t border-gray-200">
                        <div class="px-4 py-2 text-sm text-gray-600" id="mobileUserEmail">Student</div>
                        <button id="mobileLogoutBtn"
                            class="block w-full px-4 py-2.5 text-sm font-medium text-center text-red-600 hover:bg-red-50 rounded-lg transition-all">
                            <i data-lucide="log-out" class="w-4 h-4 inline mr-1"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main id="main" class="max-w-7xl mx-auto px-4 py-8" role="main">
        <!-- Welcome Section -->
        <section class="mb-8">
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 md:p-8">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">
                            Welcome back, <span id="userName">Student</span>! ðŸ‘‹
                        </h1>
                        <p class="text-gray-600">Continue your learning journey</p>
                    </div>
                    <div class="flex gap-3">
                        <a href="courses.html" class="btn-primary">
                            <i data-lucide="book-open" class="w-4 h-4 inline mr-2"></i>
                            Browse Courses
                        </a>
                        <a href="quiz.html" class="btn-outline-indigo">
                            <i data-lucide="clipboard-list" class="w-4 h-4 inline mr-2"></i>
                            Take Quiz
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Cards -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div
                class="p-5 border-2 border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-md hover:border-indigo-300 transition">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-500">Enrolled Courses</div>
                    <i data-lucide="book-open" class="w-5 h-5 text-blue-600"></i>
                </div>
                <div id="statEnrolled" class="text-3xl font-bold text-gray-900">0</div>
                <div class="text-xs text-gray-500 mt-1">Active courses</div>
            </div>
            <div
                class="p-5 border-2 border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-md hover:border-indigo-300 transition">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-500">Completed</div>
                    <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                </div>
                <div id="statCompleted" class="text-3xl font-bold text-gray-900">0</div>
                <div class="text-xs text-gray-500 mt-1">Courses finished</div>
            </div>
            <div
                class="p-5 border-2 border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-md hover:border-indigo-300 transition">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-500">Quiz Score</div>
                    <i data-lucide="award" class="w-5 h-5 text-yellow-600"></i>
                </div>
                <div id="statQuizScore" class="text-3xl font-bold text-gray-900">â€”</div>
                <div class="text-xs text-gray-500 mt-1">Average score</div>
            </div>
            <div
                class="p-5 border-2 border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-md hover:border-indigo-300 transition">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-500">Study Time</div>
                    <i data-lucide="clock" class="w-5 h-5 text-purple-600"></i>
                </div>
                <div id="statStudyTime" class="text-3xl font-bold text-gray-900">0h</div>
                <div class="text-xs text-gray-500 mt-1">This week</div>
            </div>
        </section>

        <!-- My Courses Section -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
                    <i data-lucide="book-marked" class="w-6 h-6 text-indigo-600"></i>
                    <span>My Courses</span>
                </h2>
                <a href="courses.html" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                    View all <i data-lucide="arrow-right" class="w-4 h-4 inline"></i>
                </a>
            </div>
            <div id="myCoursesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Courses will be loaded here -->
                <div class="col-span-full text-center py-12 text-gray-500">
                    <i data-lucide="book-open" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                    <p>No enrolled courses yet</p>
                    <a href="courses.html" class="text-indigo-600 hover:text-indigo-700 mt-2 inline-block">
                        Browse courses to get started
                    </a>
                </div>
            </div>
        </section>

        <!-- Learning Goals & Achievements -->
        <section class="mb-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Learning Goals -->
                <div class="bg-white border-2 border-gray-200 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <i data-lucide="target" class="w-5 h-5 text-indigo-600"></i>
                            <span>Learning Goals</span>
                        </h3>
                        <button id="addGoalBtn" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                            <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                            Add Goal
                        </button>
                    </div>
                    <div id="goalsList" class="space-y-3">
                        <!-- Goals will be loaded here -->
                        <div class="text-center py-8 text-gray-500 text-sm">
                            <i data-lucide="target" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                            <p>No goals set yet</p>
                        </div>
                    </div>
                </div>

                <!-- Achievements & Badges -->
                <div class="bg-white border-2 border-gray-200 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <i data-lucide="award" class="w-5 h-5 text-yellow-600"></i>
                            <span>Achievements</span>
                        </h3>
                        <span class="text-sm text-gray-500" id="achievementCount">0 badges</span>
                    </div>
                    <div id="achievementsList" class="grid grid-cols-3 gap-3">
                        <!-- Achievements will be loaded here -->
                        <div class="col-span-3 text-center py-8 text-gray-500 text-sm">
                            <i data-lucide="award" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                            <p>No achievements yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Study Streak & Timer -->
        <section class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Study Streak -->
                <div class="bg-gradient-to-br from-orange-50 to-yellow-50 border-2 border-orange-200 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <i data-lucide="flame" class="w-5 h-5 text-orange-600"></i>
                            <span>Study Streak</span>
                        </h3>
                    </div>
                    <div class="text-center">
                        <div id="streakCount" class="text-5xl font-bold text-orange-600 mb-2">0</div>
                        <p class="text-sm text-gray-600 mb-4">days in a row</p>
                        <div class="flex justify-center gap-1">
                            <!-- Streak days will be shown here -->
                            <div class="text-xs text-gray-500">Keep learning to build your streak!</div>
                        </div>
                    </div>
                </div>

                <!-- Study Timer -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <i data-lucide="timer" class="w-5 h-5 text-blue-600"></i>
                            <span>Study Timer</span>
                        </h3>
                    </div>
                    <div class="text-center">
                        <div id="timerDisplay" class="text-4xl font-mono font-bold text-blue-600 mb-4">00:00:00</div>
                        <div class="flex gap-2 justify-center">
                            <button id="startTimerBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                                <i data-lucide="play" class="w-4 h-4 inline mr-1"></i>
                                Start
                            </button>
                            <button id="stopTimerBtn" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition font-medium hidden">
                                <i data-lucide="square" class="w-4 h-4 inline mr-1"></i>
                                Stop
                            </button>
                            <button id="resetTimerBtn" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium">
                                <i data-lucide="rotate-ccw" class="w-4 h-4 inline mr-1"></i>
                                Reset
                            </button>
                        </div>
                        <p class="text-xs text-gray-600 mt-4">Total study time today: <span id="todayStudyTime">0h 0m</span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Course Recommendations -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
                    <i data-lucide="sparkles" class="w-6 h-6 text-purple-600"></i>
                    <span>Recommended for You</span>
                </h2>
                <a href="courses.html" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                    View all <i data-lucide="arrow-right" class="w-4 h-4 inline"></i>
                </a>
            </div>
            <div id="recommendedCourses" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Recommended courses will be loaded here -->
                <div class="col-span-full text-center py-8 text-gray-500 text-sm">
                    <i data-lucide="sparkles" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                    <p>No recommendations yet</p>
                </div>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <i data-lucide="activity" class="w-6 h-6 text-indigo-600"></i>
                <span>Recent Activity</span>
            </h2>
            <div id="recentActivity" class="bg-white border-2 border-gray-200 rounded-xl p-6">
                <div class="space-y-4">
                    <!-- Activity items will be loaded here -->
                    <div class="text-center py-8 text-gray-500">
                        <i data-lucide="clock" class="w-10 h-10 mx-auto mb-3 text-gray-300"></i>
                        <p>No recent activity</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center text-xs text-gray-500 py-6 border-t mt-12">
        &copy; 2024 Learning Management System. All rights reserved.
    </footer>
    <div id="toast-root" class="fixed top-4 right-4 space-y-2 z-50"></div>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="src/lucide-init.js"></script>
    <script type="module" src="src/main.js"></script>
    <script>
        // Check authentication
        (function () {
            const auth = JSON.parse(localStorage.getItem('auth') || '{}');
            if (!auth.email || auth.role !== 'student') {
                window.location.href = 'signin.html';
                return;
            }

            // Display user info
            document.getElementById('userName').textContent = auth.name || auth.email.split('@')[0];
            document.getElementById('userEmail').textContent = auth.email;
            const mobileEmail = document.getElementById('mobileUserEmail');
            if (mobileEmail) mobileEmail.textContent = auth.email;

            // Logout functionality
            function logout() {
                localStorage.removeItem('auth');
                window.location.href = 'signin.html';
            }
            document.getElementById('logoutBtn')?.addEventListener('click', logout);
            document.getElementById('mobileLogoutBtn')?.addEventListener('click', logout);

            // Load dashboard data
            const savedCourses = JSON.parse(localStorage.getItem('saved.courses') || '[]');
            const enrolledCourses = JSON.parse(localStorage.getItem('enrolled.courses') || '[]');

            // Update stats
            document.getElementById('statEnrolled').textContent = enrolledCourses.length;
            document.getElementById('statCompleted').textContent =
                JSON.parse(localStorage.getItem('completed.courses') || '[]').length;

            const quizScores = JSON.parse(localStorage.getItem('quiz.scores') || '[]');
            if (quizScores.length > 0) {
                const avg = Math.round(quizScores.reduce((a, b) => a + b, 0) / quizScores.length);
                document.getElementById('statQuizScore').textContent = avg + '%';
            }

            // Study Timer Functionality
            let timerInterval = null;
            let timerSeconds = 0;
            let isTimerRunning = false;
            const startTimerBtn = document.getElementById('startTimerBtn');
            const stopTimerBtn = document.getElementById('stopTimerBtn');
            const resetTimerBtn = document.getElementById('resetTimerBtn');
            const timerDisplay = document.getElementById('timerDisplay');
            const todayStudyTimeEl = document.getElementById('todayStudyTime');

            function formatTime(seconds) {
                const hrs = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }

            function updateTodayStudyTime() {
                const today = new Date().toDateString();
                const studyData = JSON.parse(localStorage.getItem('study.time') || '{}');
                const todayTime = studyData[today] || 0;
                const hours = Math.floor(todayTime / 3600);
                const minutes = Math.floor((todayTime % 3600) / 60);
                todayStudyTimeEl.textContent = `${hours}h ${minutes}m`;
            }

            startTimerBtn?.addEventListener('click', () => {
                isTimerRunning = true;
                startTimerBtn.classList.add('hidden');
                stopTimerBtn.classList.remove('hidden');
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    timerDisplay.textContent = formatTime(timerSeconds);
                }, 1000);
            });

            stopTimerBtn?.addEventListener('click', () => {
                isTimerRunning = false;
                clearInterval(timerInterval);
                startTimerBtn.classList.remove('hidden');
                stopTimerBtn.classList.add('hidden');
                
                // Save study time
                const today = new Date().toDateString();
                const studyData = JSON.parse(localStorage.getItem('study.time') || '{}');
                studyData[today] = (studyData[today] || 0) + timerSeconds;
                localStorage.setItem('study.time', JSON.stringify(studyData));
                updateTodayStudyTime();
                
                // Update study time stat
                const totalToday = studyData[today];
                const hours = Math.floor(totalToday / 3600);
                document.getElementById('statStudyTime').textContent = hours + 'h';
            });

            resetTimerBtn?.addEventListener('click', () => {
                clearInterval(timerInterval);
                timerSeconds = 0;
                timerDisplay.textContent = formatTime(0);
                startTimerBtn.classList.remove('hidden');
                stopTimerBtn.classList.add('hidden');
                isTimerRunning = false;
            });

            updateTodayStudyTime();

            // Study Streak Functionality
            function updateStreak() {
                const today = new Date().toDateString();
                const streakData = JSON.parse(localStorage.getItem('study.streak') || '{}');
                const lastStudyDate = streakData.lastDate;
                const currentStreak = streakData.streak || 0;
                
                if (lastStudyDate === today) {
                    // Already studied today
                    document.getElementById('streakCount').textContent = currentStreak;
                } else {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    if (lastStudyDate === yesterday.toDateString()) {
                        // Continue streak
                        streakData.streak = currentStreak + 1;
                        streakData.lastDate = today;
                        document.getElementById('streakCount').textContent = streakData.streak;
                    } else {
                        // Reset streak
                        streakData.streak = 1;
                        streakData.lastDate = today;
                        document.getElementById('streakCount').textContent = 1;
                    }
                    localStorage.setItem('study.streak', JSON.stringify(streakData));
                }
            }
            updateStreak();

            // Learning Goals Functionality
            function loadGoals() {
                const goals = JSON.parse(localStorage.getItem('learning.goals') || '[]');
                const goalsList = document.getElementById('goalsList');
                
                if (goals.length === 0) {
                    goalsList.innerHTML = `
                        <div class="text-center py-8 text-gray-500 text-sm">
                            <i data-lucide="target" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                            <p>No goals set yet</p>
                        </div>
                    `;
                    setTimeout(() => lucide.createIcons(), 100);
                    return;
                }

                goalsList.innerHTML = goals.map((goal, index) => `
                    <div class="p-4 border border-gray-200 rounded-lg hover:border-indigo-300 transition">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900">${goal.title}</h4>
                                <p class="text-sm text-gray-600 mt-1">${goal.description || ''}</p>
                            </div>
                            <button onclick="deleteGoal(${index})" class="text-red-600 hover:text-red-800">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <div class="mt-3">
                            <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                <span>Progress</span>
                                <span>${goal.progress || 0}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-indigo-600 h-2 rounded-full transition-all" style="width: ${goal.progress || 0}%"></div>
                            </div>
                        </div>
                    </div>
                `).join('');
                setTimeout(() => lucide.createIcons(), 100);
            }

            window.deleteGoal = function(index) {
                const goals = JSON.parse(localStorage.getItem('learning.goals') || '[]');
                goals.splice(index, 1);
                localStorage.setItem('learning.goals', JSON.stringify(goals));
                loadGoals();
            };

            document.getElementById('addGoalBtn')?.addEventListener('click', () => {
                const title = prompt('Enter goal title:');
                if (title) {
                    const description = prompt('Enter goal description (optional):') || '';
                    const goals = JSON.parse(localStorage.getItem('learning.goals') || '[]');
                    goals.push({ title, description, progress: 0, createdAt: new Date().toISOString() });
                    localStorage.setItem('learning.goals', JSON.stringify(goals));
                    loadGoals();
                    if (typeof toast === 'function') {
                        toast('Goal added successfully', 'success');
                    }
                }
            });

            loadGoals();

            // Achievements Functionality
            function loadAchievements() {
                const achievements = JSON.parse(localStorage.getItem('achievements') || '[]');
                const achievementsList = document.getElementById('achievementsList');
                const achievementCount = document.getElementById('achievementCount');
                
                // Auto-award achievements based on activity
                const enrolledCount = enrolledCourses.length;
                const completedCount = JSON.parse(localStorage.getItem('completed.courses') || '[]').length;
                const quizScores = JSON.parse(localStorage.getItem('quiz.scores') || '[]');
                
                const availableAchievements = [
                    { id: 'first-course', name: 'First Steps', icon: 'book-open', color: 'blue', earned: enrolledCount > 0 },
                    { id: 'course-master', name: 'Course Master', icon: 'graduation-cap', color: 'purple', earned: completedCount >= 3 },
                    { id: 'quiz-ace', name: 'Quiz Ace', icon: 'award', color: 'yellow', earned: quizScores.some(s => s >= 90) },
                    { id: 'week-warrior', name: 'Week Warrior', icon: 'flame', color: 'orange', earned: JSON.parse(localStorage.getItem('study.streak') || '{}').streak >= 7 }
                ];

                const earnedAchievements = availableAchievements.filter(a => a.earned);
                achievementCount.textContent = `${earnedAchievements.length} badges`;

                if (earnedAchievements.length === 0) {
                    achievementsList.innerHTML = `
                        <div class="col-span-3 text-center py-8 text-gray-500 text-sm">
                            <i data-lucide="award" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                            <p>No achievements yet</p>
                        </div>
                    `;
                } else {
                    achievementsList.innerHTML = earnedAchievements.map(achievement => `
                        <div class="text-center p-3 bg-gradient-to-br from-${achievement.color}-50 to-${achievement.color}-100 rounded-lg border-2 border-${achievement.color}-200">
                            <i data-lucide="${achievement.icon}" class="w-8 h-8 mx-auto mb-2 text-${achievement.color}-600"></i>
                            <p class="text-xs font-semibold text-gray-900">${achievement.name}</p>
                        </div>
                    `).join('');
                }
                setTimeout(() => lucide.createIcons(), 100);
            }
            loadAchievements();

            // Course Recommendations
            function loadRecommendations() {
                const allCourses = JSON.parse(localStorage.getItem('admin.courses') || '[]');
                const enrolledIds = enrolledCourses;
                const recommended = allCourses
                    .filter(c => !enrolledIds.includes(c.id))
                    .slice(0, 3);
                
                const recommendedContainer = document.getElementById('recommendedCourses');
                if (recommended.length === 0) {
                    recommendedContainer.innerHTML = `
                        <div class="col-span-full text-center py-8 text-gray-500 text-sm">
                            <i data-lucide="sparkles" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                            <p>No recommendations yet</p>
                        </div>
                    `;
                    return;
                }

                recommendedContainer.innerHTML = recommended.map(course => `
                    <div class="group p-4 border-2 border-gray-200 rounded-xl bg-white hover:shadow-md hover:border-indigo-300 transition">
                        <div class="relative rounded-lg overflow-hidden mb-3 h-32">
                            <img src="${course.image || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=400&h=300&fit=crop'}" 
                                alt="${course.title}" class="w-full h-full object-cover">
                        </div>
                        <h3 class="font-semibold text-gray-900 mb-1">${course.title}</h3>
                        <p class="text-xs text-gray-600 mb-3">${course.category} â€¢ ${course.level}</p>
                        <a href="courses.html" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                            View Course <i data-lucide="arrow-right" class="w-3 h-3 inline"></i>
                        </a>
                    </div>
                `).join('');
                setTimeout(() => lucide.createIcons(), 100);
            }
            loadRecommendations();

            // Load enrolled courses
            const courseMap = {
                'js-101': { title: 'JavaScript 101', category: 'Programming', level: 'Beginner', image: 'https://images.unsplash.com/photo-1627398242454-45a1465c2479?w=400&h=300&fit=crop' },
                'py-201': { title: 'Python for Data', category: 'Data', level: 'Intermediate', image: 'https://images.unsplash.com/photo-1526378722484-bd91ca387e72?w=400&h=300&fit=crop' },
                'ux-101': { title: 'UX Fundamentals', category: 'Design', level: 'Beginner', image: 'https://images.unsplash.com/photo-1561070791-2526d30994b5?w=400&h=300&fit=crop' },
                'react-301': { title: 'React Fundamentals', category: 'Programming', level: 'Intermediate', image: 'https://images.unsplash.com/photo-1633356122544-f134324a6cee?w=400&h=300&fit=crop' },
                'ds-101': { title: 'Data Science Basics', category: 'Data', level: 'Beginner', image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=300&fit=crop' },
                'css-advanced': { title: 'Advanced CSS', category: 'Design', level: 'Advanced', image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop' },
                'node-101': { title: 'Node.js 101', category: 'Programming', level: 'Beginner', image: 'https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=400&h=300&fit=crop' },
                'sql-101': { title: 'SQL for Beginners', category: 'Data', level: 'Beginner', image: 'https://images.unsplash.com/photo-1544383835-bda2bc66a55d?w=400&h=300&fit=crop' },
                'ui-201': { title: 'UI Design Patterns', category: 'Design', level: 'Intermediate', image: 'https://images.unsplash.com/photo-1561070791-2526d30994b5?w=400&h=300&fit=crop' }
            };

            // Load enrolled courses with progress
            const grid = document.getElementById('myCoursesGrid');
            const courseProgress = JSON.parse(localStorage.getItem('course.progress') || '{}');
            const allCourses = JSON.parse(localStorage.getItem('admin.courses') || '[]');
            
            if (enrolledCourses.length > 0) {
                grid.innerHTML = '';
                enrolledCourses.forEach(id => {
                    // Try to get from admin courses first, then fallback to courseMap
                    let course = allCourses.find(c => c.id === id);
                    if (!course) {
                        course = courseMap[id];
                        if (!course) return;
                    }
                    
                    const progress = courseProgress[id] || 0;
                    const isCompleted = progress >= 100;
                    
                    const card = document.createElement('article');
                    card.className = 'group p-4 border-2 border-gray-200 rounded-xl bg-white hover:shadow-md hover:border-indigo-300 transition overflow-hidden';
                    card.innerHTML = `
                        <div class="relative rounded-lg overflow-hidden mb-4 h-40">
                            <img src="${course.image || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=400&h=300&fit=crop'}" 
                                alt="${course.title}" 
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" 
                                loading="lazy">
                            ${isCompleted ? `
                            <div class="absolute top-3 right-3 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold flex items-center gap-1">
                                <i data-lucide="check-circle" class="w-3 h-3"></i>
                                <span>Completed</span>
                            </div>
                            ` : ''}
                        </div>
                        <h3 class="font-semibold text-lg mb-2 text-gray-900">${course.title}</h3>
                        <p class="text-sm text-gray-600 mb-3">${course.category} â€¢ ${course.level}</p>
                        ${progress > 0 ? `
                        <div class="mb-3">
                            <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                <span>Progress</span>
                                <span class="font-semibold">${progress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-indigo-500 to-purple-500 h-2 rounded-full transition-all" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        ` : ''}
                        <div class="flex items-center gap-2">
                            <a href="courses.html#${id}" class="flex-1 text-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium text-sm">
                                ${isCompleted ? 'Review Course' : 'Continue Learning'}
                            </a>
                            ${!isCompleted ? `
                            <button onclick="markCourseComplete('${id}')" 
                                class="px-3 py-2 border-2 border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition"
                                title="Mark as complete">
                                <i data-lucide="check" class="w-4 h-4 text-gray-600"></i>
                            </button>
                            ` : ''}
                        </div>
                    `;
                    grid.appendChild(card);
                });
                setTimeout(() => lucide.createIcons(), 100);
            }

            window.markCourseComplete = function(courseId) {
                if (confirm('Mark this course as complete?')) {
                    const progress = JSON.parse(localStorage.getItem('course.progress') || '{}');
                    progress[courseId] = 100;
                    localStorage.setItem('course.progress', JSON.stringify(progress));
                    
                    const completed = JSON.parse(localStorage.getItem('completed.courses') || '[]');
                    if (!completed.includes(courseId)) {
                        completed.push(courseId);
                        localStorage.setItem('completed.courses', JSON.stringify(completed));
                    }
                    
                    // Reload courses
                    const grid = document.getElementById('myCoursesGrid');
                    const enrolledCourses = JSON.parse(localStorage.getItem('enrolled.courses') || '[]');
                    grid.innerHTML = '';
                    enrolledCourses.forEach(id => {
                        let course = allCourses.find(c => c.id === id) || courseMap[id];
                        if (!course) return;
                        const progress = JSON.parse(localStorage.getItem('course.progress') || '{}')[id] || 0;
                        const isCompleted = progress >= 100;
                        const card = document.createElement('article');
                        card.className = 'group p-4 border-2 border-gray-200 rounded-xl bg-white hover:shadow-md hover:border-indigo-300 transition overflow-hidden';
                        card.innerHTML = `
                            <div class="relative rounded-lg overflow-hidden mb-4 h-40">
                                <img src="${course.image || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=400&h=300&fit=crop'}" 
                                    alt="${course.title}" 
                                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" 
                                    loading="lazy">
                                ${isCompleted ? `
                                <div class="absolute top-3 right-3 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold flex items-center gap-1">
                                    <i data-lucide="check-circle" class="w-3 h-3"></i>
                                    <span>Completed</span>
                                </div>
                                ` : ''}
                            </div>
                            <h3 class="font-semibold text-lg mb-2 text-gray-900">${course.title}</h3>
                            <p class="text-sm text-gray-600 mb-3">${course.category} â€¢ ${course.level}</p>
                            ${progress > 0 ? `
                            <div class="mb-3">
                                <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                    <span>Progress</span>
                                    <span class="font-semibold">${progress}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-indigo-500 to-purple-500 h-2 rounded-full transition-all" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            ` : ''}
                            <div class="flex items-center gap-2">
                                <a href="courses.html#${id}" class="flex-1 text-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium text-sm">
                                    ${isCompleted ? 'Review Course' : 'Continue Learning'}
                                </a>
                                ${!isCompleted ? `
                                <button onclick="markCourseComplete('${id}')" 
                                    class="px-3 py-2 border-2 border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition"
                                    title="Mark as complete">
                                    <i data-lucide="check" class="w-4 h-4 text-gray-600"></i>
                                </button>
                                ` : ''}
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                    setTimeout(() => lucide.createIcons(), 100);
                    
                    // Update stats
                    document.getElementById('statCompleted').textContent = completed.length;
                    loadAchievements();
                    
                    if (typeof toast === 'function') {
                        toast('Course marked as complete! ðŸŽ‰', 'success');
                    }
                }
            };
        })();
    </script>
</body>

</html>