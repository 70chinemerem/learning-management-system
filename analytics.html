<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics ‚Ä¢ Learning Management System</title>
    <link rel="stylesheet" href="src/style.css">
    <link rel="icon" href="src/assets/logo.svg" type="image/svg+xml">
</head>

<body>
    <a href="#main"
        class="sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 focus:z-50 focus:bg-white focus:text-blue-700 focus:px-3 focus:py-2 focus:rounded">Skip
        to main content</a>
    <header class="border-b bg-white">
        <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between">
            <a href="index.html"><img src="src/assets/logo.svg" alt="LMS Logo" class="h-8"></a>
            <nav class="hidden md:flex items-center gap-4 text-sm" aria-label="Primary">
                <a class="text-gray-700 hover:text-blue-700" href="features.html">Features</a>
                <a class="text-gray-700 hover:text-blue-700" href="saved.html">Saved</a>
                <a class="btn-primary" href="signin.html">Sign in</a>
            </nav>
            <a href="signin.html" class="md:hidden text-white hover:text-white text-sm mr-2">Sign in</a>
            <button id="mobileMenuToggle"
                class="md:hidden inline-flex items-center justify-center h-9 w-9 rounded border"
                aria-controls="mobileMenu" aria-expanded="false" aria-label="Open menu">‚ò∞</button>
        </div>
        <div id="mobileMenu" class="md:hidden hidden border-t">
            <nav class="max-w-6xl mx-auto px-4 py-3 grid gap-2 text-sm" aria-label="Mobile">
                <a class="block text-gray-700" href="features.html" data-i18n="nav.features">Features</a>
                <a class="block text-gray-700" href="saved.html" data-i18n="nav.saved">Saved</a>
                <a class="block text-gray-700" href="courses.html" data-i18n="nav.browse">Browse courses</a>
                <a class="block text-gray-700" href="quiz.html" data-i18n="nav.quiz">Take a quiz</a>
                <a class="block text-gray-700" href="analytics.html" data-i18n="nav.analytics">View analytics</a>
                <a class="inline-block mt-1 btn-primary w-max" href="signup.html">Sign
                    up</a>
            </nav>
        </div>
    </header>

    <main id="main" class="max-w-6xl mx-auto px-4 py-10" role="main">
        <div class="mb-4"><a href="index.html"
                class="inline-flex items-center gap-1 text-sm text-blue-700 hover:underline"
                data-i18n="common.backHome">‚Üê Back to home</a></div>
        <h1 class="text-2xl font-semibold mb-2" data-i18n="page.analytics">Analytics overview</h1>
        <p class="text-sm text-gray-600 mb-6">Track learner engagement, course performance, and key metrics at a glance.
        </p>

        <!-- Key Metrics -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="p-5 border rounded-lg bg-white shadow-sm hover:shadow transition">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-500">Active learners</div>
                    <div class="text-blue-600">üë•</div>
                </div>
                <div id="metricActive" class="text-3xl font-bold text-gray-900">‚Äî</div>
                <div class="text-xs text-gray-500 mt-1">+12% from last month</div>
            </div>
            <div class="p-5 border rounded-lg bg-white shadow-sm hover:shadow transition">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-500">Completion rate</div>
                    <div class="text-green-600">‚úì</div>
                </div>
                <div id="metricCompletion" class="text-3xl font-bold text-gray-900">‚Äî</div>
                <div class="text-xs text-gray-500 mt-1">+5% from last month</div>
            </div>
            <div class="p-5 border rounded-lg bg-white shadow-sm hover:shadow transition">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-500">At-risk learners</div>
                    <div class="text-orange-600">‚ö†</div>
                </div>
                <div id="metricRisk" class="text-3xl font-bold text-gray-900">‚Äî</div>
                <div class="text-xs text-gray-500 mt-1">-8% from last month</div>
            </div>
            <div class="p-5 border rounded-lg bg-white shadow-sm hover:shadow transition">
                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-500">Total courses</div>
                    <div class="text-purple-600">üìö</div>
                </div>
                <div id="metricCourses" class="text-3xl font-bold text-gray-900">9</div>
                <div class="text-xs text-gray-500 mt-1">3 new this month</div>
            </div>
        </section>

        <!-- Charts Row -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <!-- Engagement Chart -->
            <div class="p-5 border rounded-lg bg-white shadow-sm">
                <div class="flex items-center justify-between mb-4">
                    <div class="font-medium text-gray-900">Daily engagement</div>
                    <select id="range" class="px-3 py-1.5 border rounded text-sm">
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                    </select>
                </div>
                <div id="chart" class="grid grid-cols-7 gap-2 h-32 items-end">
                    <!-- bars injected by JS -->
                </div>
                <div id="chartLabels" class="grid grid-cols-7 gap-2 mt-2 text-xs text-gray-500">
                    <!-- labels injected by JS -->
                </div>
            </div>

            <!-- Course Performance -->
            <div class="p-5 border rounded-lg bg-white shadow-sm">
                <div class="font-medium text-gray-900 mb-4">Top performing courses</div>
                <div id="coursePerformance" class="space-y-3">
                    <!-- injected by JS -->
                </div>
            </div>
        </section>

        <!-- Additional Metrics -->
        <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="p-5 border rounded-lg bg-white shadow-sm">
                <div class="text-sm text-gray-500 mb-1">Average time per session</div>
                <div id="metricSessionTime" class="text-2xl font-bold text-gray-900">‚Äî</div>
                <div class="text-xs text-gray-500 mt-1">Last 7 days</div>
            </div>
            <div class="p-5 border rounded-lg bg-white shadow-sm">
                <div class="text-sm text-gray-500 mb-1">Quiz pass rate</div>
                <div id="metricQuizPass" class="text-2xl font-bold text-gray-900">‚Äî</div>
                <div class="text-xs text-gray-500 mt-1">All quizzes</div>
            </div>
            <div class="p-5 border rounded-lg bg-white shadow-sm">
                <div class="text-sm text-gray-500 mb-1">New enrollments</div>
                <div id="metricEnrollments" class="text-2xl font-bold text-gray-900">‚Äî</div>
                <div class="text-xs text-gray-500 mt-1">This month</div>
            </div>
        </section>
    </main>

    <div id="toast-root" class="fixed top-4 right-4 space-y-2 z-50"></div>
    <script type="module" src="src/main.js"></script>
    <script>
        (function () {
            const metricsKey = 'analytics.metrics.v1';
            const rangeKey = 'analytics.range.v1';

            function read(key, fallback) { try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch { return fallback; } }
            function write(key, value) { try { localStorage.setItem(key, JSON.stringify(value)); } catch { } }

            // Demo metrics (persisted)
            let metrics = read(metricsKey, null);
            if (!metrics) {
                metrics = {
                    active: Math.floor(50 + Math.random() * 150),
                    completion: Math.floor(40 + Math.random() * 50),
                    risk: Math.floor(5 + Math.random() * 20),
                    sessionTime: Math.floor(25 + Math.random() * 20),
                    quizPass: Math.floor(65 + Math.random() * 25),
                    enrollments: Math.floor(30 + Math.random() * 50)
                };
                write(metricsKey, metrics);
            }

            // Display key metrics
            document.getElementById('metricActive').textContent = metrics.active;
            document.getElementById('metricCompletion').textContent = metrics.completion + '%';
            document.getElementById('metricRisk').textContent = metrics.risk;
            document.getElementById('metricSessionTime').textContent = metrics.sessionTime + ' min';
            document.getElementById('metricQuizPass').textContent = metrics.quizPass + '%';
            document.getElementById('metricEnrollments').textContent = metrics.enrollments;

            // Engagement chart
            const chart = document.getElementById('chart');
            const chartLabels = document.getElementById('chartLabels');
            const range = document.getElementById('range');

            function getDayLabel(dayIndex, days) {
                if (days === 7) {
                    const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    const today = new Date().getDay();
                    return daysOfWeek[(today - 6 + dayIndex) % 7];
                } else {
                    const date = new Date();
                    date.setDate(date.getDate() - (29 - dayIndex));
                    return (date.getMonth() + 1) + '/' + date.getDate();
                }
            }

            function renderBars(days) {
                chart.innerHTML = '';
                chartLabels.innerHTML = '';
                const values = Array.from({ length: days }).map(() => Math.floor(10 + Math.random() * 90));
                const max = Math.max(...values, 1);

                values.forEach((v, i) => {
                    const h = Math.max(8, Math.round((v / max) * 100));
                    const bar = document.createElement('div');
                    bar.className = 'bg-gradient-to-t from-blue-600 to-blue-400 rounded-t';
                    bar.style.height = h + '%';
                    bar.title = v + ' events';
                    chart.appendChild(bar);

                    const label = document.createElement('div');
                    label.className = 'text-center';
                    label.textContent = getDayLabel(i, days);
                    chartLabels.appendChild(label);
                });
            }

            // Course performance
            const coursePerformance = document.getElementById('coursePerformance');
            const courses = [
                { name: 'JavaScript 101', completion: 87, enrolled: 145 },
                { name: 'Python for Data', completion: 82, enrolled: 128 },
                { name: 'React Fundamentals', completion: 75, enrolled: 112 },
                { name: 'UX Fundamentals', completion: 79, enrolled: 98 }
            ];

            courses.forEach(course => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
                item.innerHTML = `
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-900">${course.name}</div>
                        <div class="text-xs text-gray-500">${course.enrolled} enrolled</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-semibold text-gray-900">${course.completion}%</div>
                        <div class="w-20 h-1.5 bg-gray-200 rounded-full mt-1">
                            <div class="h-full bg-blue-600 rounded-full" style="width: ${course.completion}%"></div>
                        </div>
                    </div>
                `;
                coursePerformance.appendChild(item);
            });

            const savedRange = read(rangeKey, '7');
            range.value = savedRange;
            renderBars(parseInt(savedRange, 10));
            range.addEventListener('change', () => {
                write(rangeKey, range.value);
                renderBars(parseInt(range.value, 10));
            });
        })();
    </script>
</body>

</html>